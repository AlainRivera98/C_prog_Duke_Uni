#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>
#include "cards.h"
#include "deck.h"
#include "eval.h"
#include "future.h"
#include "input.h"

deck_t * build_hand(){
  deck_t * deck = emptyDeck();

  for(unsigned i = 0; i < 52; i++){
    card_t card = card_from_num(i);
    add_card_to(deck, card);
  }

  shuffle(deck);

  deck_t * hand = emptyDeck();

  for(size_t i = 0; i < 10; i++){
    card_t *c = deck->cards[i];
    add_card_to(hand, *c);
  }

  free_deck(deck);

  return hand;

}


int main(int argc, char ** argv){

  if(argc != 2){
    char *err_str;
    err_str = (argc > 2)?"More arguments than needed\n":"No file: need arguments\n";
    fprintf(stderr,"%s",err_str);
    return EXIT_FAILURE;
  }

  FILE *f = fopen(argv[1],"r");

  size_t n_hands = 0;
  future_cards_t * fc = empty_future();
  
  deck_t ** handArray = read_input(f, &n_hands, fc);
 
  deck_t * unknown_hand = build_hand();
  
  future_cards_from_deck(unknown_hand, fc);

  for(size_t i = 0; i < n_hands; i++){
    
    print_hand(handArray[i]);
    printf("\n");
    free_deck(handArray[i]);
  }
  
  
  if(fclose(f) != 0){
    perror("Failed to close the file!\n");
    return EXIT_FAILURE;
  }

  free_future(fc);
  free_deck(unknown_hand);
  
  return(EXIT_SUCCESS);
}


/*
deck_t * build_hand(int offset){
  deck_t * deck = emptyDeck();

  for(unsigned i = 0; i < 52; i++){
    card_t card = card_from_num(i);
    add_card_to(deck, card);
  }

  shuffle(deck);

  deck_t * hand = emptyDeck();

  for(size_t i = 0; i < 5; i++){
    card_t * c = deck->cards[i + offset];
    add_card_to(hand, *c);
  }

  free_deck(deck);

  return hand;
}


int main(void){
  deck_t * hand = build_hand(0);
  deck_t * hand2 = build_hand(5);

  print_hand(hand);
  printf("\n");
  print_hand(hand2);
  printf("\n");
  
  future_cards_t * fc = empty_future();

  card_t * emptyCard = add_empty_card(hand);
  add_future_card(fc,2,emptyCard);

  emptyCard = add_empty_card(hand);
  add_future_card(fc,0,emptyCard);

  future_cards_from_deck(hand2, fc);

  print_hand(hand);
  printf("\n");

  free_future(fc);
  free_deck(hand);
  free_deck(hand2);
  
  return(EXIT_SUCCESS);
}
*/
